@(details: ProductDetails, editForm: Form[ProductData])(implicit messages: Messages, request: RequestHeader)

@import views.Bootstrap._

@admin.base {
    <h1>@details.product.name</h1>
    <div id="noEdit" class="collapse in">
    <button type="button" class="btn-link pull-right btn-xs" data-toggle="collapse" data-target="#editForm, #noEdit">
        <span class="glyphicon glyphicon-edit"></span> Edit
    </button>
    @details.product.description.map(util.multiline.render)
    </div>

    @helper.form(action = routes.Application.doEditProduct(details.product.id), 'id → "editForm", 'class → "collapse") {
        @if(editForm.hasErrors) {
            <script type="text/javascript">
                $('#editForm, #noEdit').toggle();
            </script>
        }
        @if(editForm.hasGlobalErrors) {
            <ul class="alert alert-danger list-unstyled">
            @editForm.globalErrors.flatMap(_.messages).map { errorMessage =>
                <li>@errorMessage</li>
            }
            </ul>
        }
        @helper.inputText(editForm("name"), 'class → "form-control")
        @helper.textarea(editForm("description"), 'class → "form-control")
        <button type="submit" class="btn btn-primary">Update</button>
        <button type="button" class="btn-link" data-toggle="collapse" data-target="#editForm, #noEdit">Cancel</button>
    }

    <h2>Copies</h2>
    @if(details.copies.isEmpty) {
    <p class="alert alert-warning">There are no copies of this product, which means that nobody can borrow it.</p>
    }
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Barcode</th>
                <th class="text-right">Status</th>
            </tr>
        </thead>
        <tbody>
        @details.copies.map { copy =>
            <tr>
                <td>@copy.code</td>
                <td class="text-right"><span class="label label-default">Unknown</span></td>
            </tr>
        }
        </tbody>
        <tfoot>
            <tr>
                <td><a href="#addCopy" data-toggle="modal">Add copy</a></td>
            </tr>
        </tfoot>
    </table>

    <div class="modal fade" id="addCopy">
        <div class="modal-dialog">
            <div class="modal-content">
                @helper.form(action = routes.Application.doAddCopy(details.product.id)) {
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Add a copy of @details.product.name</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="control-label" for="barcode">Barcode</label>
                        <input type="text" required name="barcode" id="barcode" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-link" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
                }
            </div>
        </div>
    </div>

    <script type="text/javascript">
        (function($) {
            $('#addCopy').on('shown.bs.modal', function () {
                $(this).find('input').focus();
            });
        })(window.jQuery);
    </script>
}